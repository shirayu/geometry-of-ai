# 第3回：プラネタリウムの建設 ～極座標へのパラダイムシフト～

## 注意事項

- 「球面上の学習」が厳密に成り立つのは、すべてのベクトルが $L_2$ 正規化（ノルム $1$ ）されている場合。
- nGPTはこれを設計として徹底するが、標準的なTransformerは必ずしもそうではない。
- vMF分布の解釈は、埋め込みを方向分布として明示的にモデル化した場合に有効。

## トピック

ノルム1制約と球面多様体の発見

## 内容

- **nGPTの衝撃（設計思想として）:** 「半径 $r$ を1に固定し、角度 $\theta$ を中心に扱う」
    - これは単なる正規化（L2 normalization）ではない（**設計の徹底**が本質）
    - **空間そのものを球面に近づける**という幾何学的覚悟（ただし設計次第）
    - ※nGPT: 2024年10月発表（Loshchilov et al., NVIDIA）、学習を4〜20倍高速化
- **プラネタリウム・メタファーの確立:**
    - データ = ドーム上の「星」
    - 意味 = 星の「配置（星座）」
    - 距離 = 球面上の角度（測地線距離）
    - 類似度 = 内積 = $\cos\theta$ （角度のコサイン）※**単位正規化が前提**
- **von Mises-Fisher (vMF) 分布:**
    - 球面上の「正規分布」としての再定義
    - 確率密度関数： $p(\mathbf{x}|\boldsymbol{\mu}, \kappa) \propto \exp(\kappa \boldsymbol{\mu}^T \mathbf{x})$
    - $\boldsymbol{\mu}$ : 平均方向（星座の中心）
    - $\kappa$ : 集中度パラメータ（星の輝きの鋭さ）
        - $\kappa \to \infty$ ：一点に集中
        - $\kappa \to 0$ ：球面全体に一様分布
- **なぜ2010年代前半にはできなかったのか？**
    - 計算の不安定性：ノルムが暴れると勾配が爆発/消失
    - 球面制約を維持したまま最適化する技術の未成熟
    - 今は安定化技術（AdamW, 正規化層, 残差等）が整っている

## メッセージ

ドームが固まる（または近づく）と、その上で物理法則を記述できるようになる

## 実装ノート

- PyTorchでは `F.normalize(x, p=2, dim=-1)` で球面への射影
- しかし「概念上の球面」と「実装上の近似」には常にギャップがある
- 完全にノルム1を維持するには各演算後に再正規化が必要
- nGPTはこれを徹底するが、標準Transformerは必ずしもそうではない

## Visualization Break I

### デモ：vMF分布を動かしてみよう（5分）

- 2次元球面（円）上でのvMF分布の可視化
- スライダーで $\kappa$ を変化させると分布がどう変わるか
- 3次元球面でのインタラクティブ回転
- 「星座が鮮明になる／ぼやける」を体感
