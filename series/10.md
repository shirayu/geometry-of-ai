# 第10回：思考の連鎖 ～推論の軌跡～

## 注意事項

- CoTを「多様体上の探索軌跡」と見る解釈は比喩であり、厳密な数学的対応ではない。
- Test-time compute scalingの効果はタスク・モデル依存であり、普遍的ではない。
- 「離散トークン列が連続軌跡を近似」という見方は、分析の枠組みとして有用だが証明されたものではない。

## トピック

Chain of Thought (CoT) の幾何学

## 内容

- **推論とは何か？**
    - 従来の理解：トークンからトークンへの遷移
    - 幾何学的理解（比喩）：**表現空間上を滑らかに移動する「旅」**
- **One-shot vs Multi-step:**
    - One-shot：質問 → 直接答え（短い経路）
    - Multi-step：質問 → 中間ステップ → 答え（迂回路）
    - 難しい問題ほど「遠回り」が必要になりやすい
- **Reasoning Model の本質（見方）:**
    - 「思考時間を延ばす」= 探索経路を増やす／検証を増やす
    - より長い系列 = より複雑な経路
    - **Test-time compute scaling:** 推論時の計算量を増やすほど性能が上がる現象が観測される
- **連続的思考と離散的出力（第4回補論との接続）:**
    - hidden states: 連続多様体上の軌跡
    - 出力トークン: 離散的な「着地点」の系列
    - **CoTの本質:** 連続的な思考を、中間的な離散トークンで「足場」を作りながら進める
    - 足場（中間トークン）があることで、より複雑な軌跡が安定する
- **HMMとの対比:**

    | モデル | 空間 | 遷移 | 文脈 |
    | --- | --- | --- | --- |
    | HMM | 離散状態 | 局所的（マルコフ性） | なし |
    | CoT (Transformer) | 連続表現 | 大域的（Attention） | 全系列 |

- **ビームサーチの幾何（比喩）:**
    - 複数の経路候補を同時に追跡
    - 「どの道が良いか？」を競わせる
    - Top-k sampling = 確率的な経路選択
- **思考の可視化（可能なら）:**
    - 中間ステップの埋め込みベクトルをプロット
    - 「どう動いたか」を追跡
    - 正解パスと誤答パスの軌跡の違い
- **モデル崩壊（Model Collapse）の幾何学:**
    - **現象:** 生成モデルが自己生成データで再学習すると、多様性が失われる
    - **幾何学的解釈（比喩）:**
        - ドーム上の星（データ点）が一点に集まりすぎる
        - 星座（データ多様体）が縮退して「線」や「点」になる
    - **原因:**
        - 生成データのバイアス（モデルが得意な領域に偏る）
        - 再学習によるフィードバックループ
    - **対策:**
        - 元データの一定割合を保持
        - 多様性を明示的に報酬化（entropy regularization など）
- **次元崩壊（Dimensional Collapse）:**
    - **現象:** 表現空間の有効次元が減少
    - **幾何学的解釈（比喩）:**
        - 高次元空間にいても、実際には低次元部分空間に集中
        - 「残りの次元が使われていない」
    - **検出方法:**
        - 埋め込み行列のSVD
        - 有効ランク（effective rank）の計測
    - **なぜ問題か:**
        - 表現力低下、過学習リスク、転移の柔軟性低下

## 実装ノート

- 有効ランクの計算：特異値分布を見る（`torch.linalg.svd()`）
- collapseの兆候：特異値が極端に偏る／エントロピーが低い

## 示唆

「賢さ」= 探索空間の形状を効率的に探索する能力、とも解釈できる

## Visualization Break III

### デモ：拡散プロセスを（R^d上で）見る（5分）

- 2次元での拡散モデルのアニメーション
- Forward：データ点 → ガウス的なノイズへ
- Reverse：ノイズ → データ点の凝縮
- スコア関数（勾配場）をベクトル場として可視化

（発展）

- Model Collapseのアニメーション：星が徐々に一点に集まる様子
- Dimensional Collapseの可視化：高次元→低次元射影で密度が偏る様子
